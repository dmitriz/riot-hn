{"version":3,"file":"bundle.js","sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/index.js","src/components/item.tag","src/components/comment.tag","src/views/news-view.tag","src/views/item-view.tag","src/views/user-view.tag","src/app.tag","src/store.js","node_modules/browserify/node_modules/events/events.js","node_modules/riot/riot.js"],"names":["riot","require","mount","tag","opts","self","this","itemdata","data","href","url","id","bind","showInfo","type","showDomain","store","open","on","fetchItems","kids","comments","update","commentcontent","innerHTML","text","toggle","page","items","fetchNews","fetchItemsByPage","displayPage","removeListener","fetchComments","fetchPollOptions","parts","options","pollOptions","fetchItem","item","fetchUser","user","about","loadView","viewName","oldEl","document","getElementById","remove","ph","insertAdjacentHTML","currentview","mountTo","studyRoute","view","route","exec","api","Firebase","storiesPerPage","cachedStoryIds","Emitter","EventEmitter","module","exports","child","snapshot","val","emit","cb","once","ids","addItem","push","length","forEach","start","end","slice","_events","_maxListeners","undefined","isFunction","arg","isNumber","isObject","isUndefined","prototype","defaultMaxListeners","setMaxListeners","n","isNaN","TypeError","er","handler","len","args","i","listeners","error","arguments","Error","call","Array","apply","addListener","listener","m","newListener","warned","console","trace","g","fired","list","position","splice","removeAllListeners","key","ret","listenerCount","emitter","loopKeys","expr","els","split","trim","pos","_each","dom","parent","remAttr","checksum","template","outerHTML","prev","previousSibling","root","parentNode","rendered","tags","one","removeChild","hasParent","tmpl","isArray","testsum","JSON","stringify","map","unmount","Object","keys","obj","arrDiff","indexOf","nodes","childNodes","prev_index","Tag","before","loop","parseNamedElements","walk","nodeType","each","attributes","attr","test","name","value","parseLayout","expressions","addExpr","extend","tagName","nodeValue","getAttribute","impl","tag_impl","toLowerCase","bool","conf","updateOpts","firstChild","is_loop","loop_dom","insertBefore","appendChild","trigger","observable","children","mkdom","p","off","mounted","fn","setEventHandler","e","window","event","which","charCode","keyCode","target","srcElement","currentTarget","preventDefault","returnValue","insertTo","node","attr_name","stub","createTextNode","style","display","setAttribute","removeAttribute","from","tag_name","root_tag","el","createElement","nextSibling","arr1","arr2","filter","doc","HTMLDocument","version","settings","callbacks","events","replace","typed","arr","fns","busy","concat","evt","hash","loc","parser","path","current","top","location","win","r","addEventListener","attachEvent","s","brackets","join","re","re_expr","Function","_","k","v","wrap","nonull","re_vars","RegExp","source","global","cache","str","b","virtual_dom","html","selector","querySelectorAll","define","amd"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var riot = require('riot')\nrequire('./components/item.tag')\nrequire('./components/comment.tag')\nrequire('./views/news-view.tag')\nrequire('./views/item-view.tag')\nrequire('./views/user-view.tag')\nrequire('./app.tag')\nriot.mount('app')\n","var riot = require('riot');\nriot.tag('item', '<span class=\"index\">{ opts.index }.</span> <p> <a class=\"title\" href=\"{ href() }\" target=\"_blank\">{ itemdata.title }</a> <span class=\"domain\" show=\"{ showDomain() }\"> ({ itemdata.url }) </span> </p> <p class=\"subtext\"> <span show=\"{ showInfo() }\"> { itemdata.score } points by <a href=\"#user/{ itemdata.by }\">{ itemdata.by }</a> </span> { time } ago <span class=\"comments-link\" show=\"{ showInfo() }\"> | <a href=\"#item/{ itemdata.id }\">comments</a> </span> </p>', function(opts) {\n  var self = this\n  self.itemdata = opts.data\n\n  this.href = function() {\n    return self.itemdata.url || ('#/item/' + self.itemdata.id)\n  }.bind(this);\n\n  this.showInfo = function() {\n    return self.itemdata.type === 'story' || self.itemdata.type === 'poll'\n  }.bind(this);\n\n  this.showDomain = function() {\n    return self.itemdata.type === 'story'\n  }.bind(this);\n  \n});\n","var riot = require('riot');\nriot.tag('comment', '<li show=\"{ data.text }\"> <div class=\"comhead\"> <a class=\"toggle\" onclick=\"{ toggle }\">{ open ? \\'[-]\\' : \\'[+]\\' }</a> <a href=\"#user/{ data.by }\">{ data.by }</a> { data.time } ago </div> <div class=\"comment-content\" name=\"commentcontent\" show=\"{ open }\"></div> <ul class=\"child-comments\" if=\"{ data.kids }\" show=\"{ open }\"> <comment each=\"{ comments }\" data=\"{ this }\"></comment> </ul> </li>', function(opts) {\n  var store = require('../store')\n  var self = this\n  self.data = opts.data\n  self.open = true\n\n  this.on('mount', function() {\n    store.fetchItems(self.data.kids, function(comments) {\n      self.comments = comments\n      self.update()\n    })\n    self.commentcontent.innerHTML = self.data.text\n  })\n\n  this.toggle = function(e) {\n    this.open = !this.open\n  }.bind(this);\n  \n});\n","var riot = require('riot');\nriot.tag('news-view', '<div class=\"view news-view\" class=\"{loading: !items.length}\"> <ul> <li class=\"item\" each=\"{ item, i in items }\" track-by=\"id\"> <item data=\"{ item }\" index=\"{ (parent.page - 1) * 30 + i + 1}\" ></item> </li> </ul> <div class=\"nav\" show=\"{ items.length }\"> <a if=\"{ opts > 1 }\" href=\"#news/{ opts - 1 }\">&lt; prev</a> <a if=\"{ opts < 4 }\" href=\"#news/{ opts - -1 }\">more...</a> </div> </div>', function(opts) {\n  var store = require('../store')\n  var self = this\n  self.page = opts\n  self.items = []\n\n  this.fetchNews = function() {\n    store.fetchItemsByPage(self.page, function (items) {\n      self.items = items\n      self.displayPage = self.page\n      self.update()\n    })\n  }.bind(this);\n\n  self.on('mount', function() {\n    self.fetchNews()\n    store.on('update', self.fetchNews)\n  })\n\n  self.on('unmount', function() {\n    store.removeListener('update', self.fetchNews)\n  })\n  \n});\n","var riot = require('riot');\nriot.tag('item-view', '<div class=\"view item-view\" show=\"{ items.length }\"> <item class=\"item\" each=\"{ items }\" data=\"{ this }\"></item> <ul class=\"poll-options\" if=\"{ pollOptions }\"> <li each=\"{ pollOptions }\"> <p>{ text }</p> <p class=\"subtext\">{ score } points</p> </li> </ul> <ul class=\"comments\" if=\"{ comments }\"> <comment each=\"{ comments }\" data=\"{ this }\"></comment> </ul> <p show=\"{ !comments.length }\">No comments yet.</p> </div>', function(opts) {\n  var store = require('../store')\n  var self = this\n  self.items = []\n\n  this.fetchComments = function() {\n    store.fetchItems(self.items[0].kids, function (comments) {\n      self.comments = comments\n      self.update()\n    })\n  }.bind(this);\n\n  this.fetchPollOptions = function() {\n    store.fetchItems(self.items[0].parts, function (options) {\n      self.pollOptions = options\n      self.update()\n    })\n  }.bind(this);\n\n  self.on('mount', function() {\n    store.fetchItem(opts, function (item) {\n      self.items = [ item ]\n      self.fetchComments()\n      if (item.type === 'poll') {\n        self.fetchPollOptions()\n      }\n      self.update()\n    })\n  })\n  \n});\n","var riot = require('riot');\nriot.tag('user-view', '<div class=\"view user-view\" show=\"{ user }\"> <ul> <li><span class=\"label\">user:</span> { user.id }</li> <li><span class=\"label\">created:</span> { user.created } ago</li> <li><span class=\"label\">karma:</span> { user.karma }</li> <li> <span class=\"label\">about:</span> <div class=\"about\" name=\"about\"></div> </li> </ul> <p class=\"links\"> <a href=\"https://news.ycombinator.com/submitted?id={ user.id }\">submissions</a><br> <a href=\"https://news.ycombinator.com/threads?id={ user.id }\">comments</a> </p> </div>', function(opts) {\n  var store = require('../store')\n  var self = this\n  self.on('mount', function() {\n    store.fetchUser(opts, function (user) {\n      self.user = user\n      self.about.innerHTML = self.user.about\n      self.update()\n    })\n  })\n  \n});\n","var riot = require('riot');\nriot.tag('app', '<div id=\"header\"> <a id=\"yc\" href=\"http://www.ycombinator.com\"> <img src=\"https://news.ycombinator.com/y18.gif\"> </a> <h1><a href=\"#\">Hacker News</a></h1> <span class=\"source\"> Built with <a href=\"https://muut.com/riotjs/\" target=\"_blank\">Riot.js</a> | <a href=\"https://github.com/txchen/riot-hn\" target=\"_blank\">Source</a> </span> </div> <div id=\"placeholder\"></div>', function(opts) {\n  var self = this\n\n  this.loadView = function(viewName, id) {\n    var oldEl = document.getElementById('hnview')\n    if (oldEl) {\n      oldEl.remove()\n    }\n    var ph = document.getElementById('placeholder');\n    ph.insertAdjacentHTML('afterend', '<div id=\"hnview\"></div>');\n    self.currentview = viewName + id\n    riot.mountTo(document.getElementById('hnview'), viewName, id)\n    self.update()\n  }.bind(this);\n\n  this.studyRoute = function(view, id) {\n    switch(view) {\n    case 'user':\n      self.loadView('user-view', id)\n      break\n    case 'item':\n      self.loadView('item-view', id)\n      break\n    case 'news':\n      self.loadView('news-view', id)\n      break\n    default:\n      riot.route('news/1')\n    }\n  }.bind(this);\n  riot.route(self.studyRoute)\n  this.on('mount', function() {\n    riot.route.exec(self.studyRoute)\n  })\n  \n});\n","//var Firebase = require('firebase')\nvar api = new Firebase('https://hacker-news.firebaseio.com/v0')\nvar storiesPerPage = 30\nvar cachedStoryIds = []\nvar Emitter = require('events').EventEmitter\nvar store = module.exports = new Emitter()\n\n/**\n * Subscribe to real time updates of the top 100 stories,\n * and cache the IDs locally.\n */\n\napi.child('topstories').on('value', function (snapshot) {\n  cachedStoryIds = snapshot.val()\n  store.emit('update')\n})\n\n/**\n * Fetch an item data with given id.\n *\n * @param {Number} id\n * @param {Function} cb(item)\n */\n\nstore.fetchItem = function (id, cb) {\n  api.child('item/' + id).once('value', function (snapshot) {\n    cb(snapshot.val())\n  })\n}\n\n/**\n * Fetch a user data with given id.\n *\n * @param {Number} id\n * @param {Function} cb(user)\n */\n\nstore.fetchUser = function (id, cb) {\n  api.child('user/' + id).once('value', function (snapshot) {\n    cb(snapshot.val())\n  })\n}\n\n/**\n * Fetch the given list of items.\n *\n * @param {Array<Number>} ids\n * @param {Function} cb(items)\n */\n\nstore.fetchItems = function (ids, cb) {\n  if (!ids || !ids.length) return cb([])\n  var items = []\n  ids.forEach(function (id) {\n    store.fetchItem(id, addItem)\n  })\n  function addItem (item) {\n    items.push(item)\n    if (items.length >= ids.length) {\n      cb(items)\n    }\n  }\n}\n\n/**\n * Fetch items for the given page.\n *\n * @param {Number} page\n * @param {Function} cb(stories)\n */\n\nstore.fetchItemsByPage = function (page, cb) {\n  var start = (page - 1) * storiesPerPage\n  var end = page * storiesPerPage\n  var ids = cachedStoryIds.slice(start, end)\n  store.fetchItems(ids, cb)\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","/* Riot v2.0.8, @license MIT, (c) 2015 Muut Inc. + contributors */\n\n;(function() {\n\nvar riot = { version: 'v2.0.8', settings: {} }\n\n'use strict'\n\nriot.observable = function(el) {\n\n  el = el || {}\n\n  var callbacks = {}\n\n  el.on = function(events, fn) {\n    if (typeof fn == 'function') {\n      events.replace(/\\S+/g, function(name, pos) {\n        (callbacks[name] = callbacks[name] || []).push(fn)\n        fn.typed = pos > 0\n      })\n    }\n    return el\n  }\n\n  el.off = function(events, fn) {\n    if (events == '*') callbacks = {}\n    else if (fn) {\n      var arr = callbacks[events]\n      for (var i = 0, cb; (cb = arr && arr[i]); ++i) {\n        if (cb == fn) { arr.splice(i, 1); i-- }\n      }\n    } else {\n      events.replace(/\\S+/g, function(name) {\n        callbacks[name] = []\n      })\n    }\n    return el\n  }\n\n  // only single event supported\n  el.one = function(name, fn) {\n    if (fn) fn.one = 1\n    return el.on(name, fn)\n  }\n\n  el.trigger = function(name) {\n    var args = [].slice.call(arguments, 1),\n        fns = callbacks[name] || []\n\n    for (var i = 0, fn; (fn = fns[i]); ++i) {\n      if (!fn.busy) {\n        fn.busy = 1\n        fn.apply(el, fn.typed ? [name].concat(args) : args)\n        if (fn.one) { fns.splice(i, 1); i-- }\n         else if (fns[i] !== fn) { i-- } // Makes self-removal possible during iteration\n        fn.busy = 0\n      }\n    }\n\n    return el\n  }\n\n  return el\n\n}\n;(function(riot, evt) {\n\n  // browsers only\n  if (!this.top) return\n\n  var loc = location,\n      fns = riot.observable(),\n      current = hash(),\n      win = window\n\n  function hash() {\n    return loc.hash.slice(1)\n  }\n\n  function parser(path) {\n    return path.split('/')\n  }\n\n  function emit(path) {\n    if (path.type) path = hash()\n\n    if (path != current) {\n      fns.trigger.apply(null, ['H'].concat(parser(path)))\n      current = path\n    }\n  }\n\n  var r = riot.route = function(arg) {\n    // string\n    if (arg[0]) {\n      loc.hash = arg\n      emit(arg)\n\n    // function\n    } else {\n      fns.on('H', arg)\n    }\n  }\n\n  r.exec = function(fn) {\n    fn.apply(null, parser(hash()))\n  }\n\n  r.parser = function(fn) {\n    parser = fn\n  }\n\n  win.addEventListener ? win.addEventListener(evt, emit, false) : win.attachEvent('on' + evt, emit)\n\n})(riot, 'hashchange')\n/*\n\n//// How it works?\n\n\nThree ways:\n\n1. Expressions: tmpl('{ value }', data).\n   Returns the result of evaluated expression as a raw object.\n\n2. Templates: tmpl('Hi { name } { surname }', data).\n   Returns a string with evaluated expressions.\n\n3. Filters: tmpl('{ show: !done, highlight: active }', data).\n   Returns a space separated list of trueish keys (mainly\n   used for setting html classes), e.g. \"show highlight\".\n\n\n// Template examples\n\ntmpl('{ title || \"Untitled\" }', data)\ntmpl('Results are { results ? \"ready\" : \"loading\" }', data)\ntmpl('Today is { new Date() }', data)\ntmpl('{ message.length > 140 && \"Message is too long\" }', data)\ntmpl('This item got { Math.round(rating) } stars', data)\ntmpl('<h1>{ title }</h1>{ body }', data)\n\n\n// Falsy expressions in templates\n\nIn templates (as opposed to single expressions) all falsy values\nexcept zero (undefined/null/false) will default to empty string:\n\ntmpl('{ undefined } - { false } - { null } - { 0 }', {})\n// will return: \" - - - 0\"\n\n\n// Customizable brackets\n\n  riot.settings.brackets = '[ ]'\n  riot.settings.brackets = '<% %>'\n\n*/\n\nvar tmpl = (function() {\n\n  var cache = {},\n      brackets,\n      re_expr,\n      re_vars = /(\"|').+?[^\\\\]\\1|\\.\\w*|\\w*:|\\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\\b|function *\\()|([a-z_]\\w*)/gi\n              // [ 1            ][ 2  ][ 3 ][ 4                                                                                  ][ 5       ]\n              // find variable names:\n              // 1. skip quoted strings: \"a b\", 'a b', 'a \\'b\\''\n              // 2. skip object properties: .name\n              // 3. skip object literals: name:\n              // 4. skip javascript keywords\n              // 5. match var name\n\n  return function(str, data) {\n\n    // make sure we use current brackets setting\n    var b = riot.settings.brackets || '{ }'\n    if(b != brackets){\n      brackets = b.split(' ')\n      re_expr = re(/({[\\s\\S]*?})/)\n    }\n\n    // build a template (or get it from cache), render with data\n    // (or just test if string has expression when called w/o data)\n    return data\n      ? str && (cache[str] = cache[str] || tmpl(str))(data)\n      : re_expr.test(str)\n\n  }\n\n\n  // create a template instance\n\n  function tmpl(s, p) {\n\n    // default template string to {}\n    p = (s || brackets.join(''))\n\n      // temporarily convert \\{ and \\} to a non-character\n      .replace(re(/\\\\{/), '\\uFFF0')\n      .replace(re(/\\\\}/), '\\uFFF1')\n      \n      // split string to expression and non-expresion parts\n      .split(re_expr)\n\n    return new Function('d', 'return ' + (\n\n      // is it a single expression or a template? i.e. {x} or <b>{x}</b>\n      !p[0] && !p[2] && !p[3]\n\n        // if expression, evaluate it\n        ? expr(p[1])\n\n        // if template, evaluate all expressions in it\n        : '[' + p.map(function(s, i) {\n\n            // is it an expression or a string (every second part is an expression)\n            return i % 2\n\n              // evaluate the expressions\n              ? expr(s, 1)\n\n              // process string parts of the template:\n              : '\"' + s\n\n                  // preserve new lines\n                  .replace(/\\n/g, '\\\\n')\n\n                  // escape quotes\n                  .replace(/\"/g, '\\\\\"')\n\n                + '\"'\n\n          }).join(',') + '].join(\"\")'\n      )\n\n      // bring escaped { and } back\n      .replace(/\\uFFF0/g, brackets[0])\n      .replace(/\\uFFF1/g, brackets[1])\n\n    )\n\n  }\n\n\n  // parse { ... } expression\n\n  function expr(s, n) {\n    s = s\n\n      // convert new lines to spaces\n      .replace(/\\n/g, ' ')\n\n      // trim whitespace, curly brackets, strip comments\n      .replace(re(/^[{ ]+|[ }]+$|\\/\\*.+?\\*\\//g), '')\n\n    // is it an object literal? i.e. { key : value }\n    return /^\\s*[\\w-\"']+ *:/.test(s)\n\n      // if object literal, return trueish keys\n      // e.g.: { show: isOpen(), done: item.done } -> \"show done\"\n      ? '[' + s.replace(/\\W*([\\w-]+)\\W*:([^,]+)/g, function(_, k, v) {\n\n          // safely execute vars to prevent undefined value errors\n          return v.replace(/\\w[^,|& ]*/g, function(v) { return wrap(v, n) }) + '?\"' + k + '\":\"\",'\n\n        }) + '].join(\" \")'\n\n      // if js expression, evaluate as javascript\n      : wrap(s, n)\n\n  }\n\n\n  // execute js w/o breaking on errors or undefined vars\n\n  function wrap(s, nonull) {\n    return '(function(v){try{v='\n\n        // prefix vars (name => data.name)\n        + (s.replace(re_vars, function(s, _, v) { return v ? '(d.'+v+'===undefined?window.'+v+':d.'+v+')' : s })\n\n          // break the expression if its empty (resulting in undefined value)\n          || 'x')\n\n      + '}finally{return '\n\n        // default to empty string for falsy values except zero\n        + (nonull ? '!v&&v!==0?\"\":v' : 'v')\n\n      + '}}).call(d)'\n  }\n\n\n  // change regexp to use custom brackets\n\n  function re(r) {\n    return RegExp(r.source\n                   .split('{').join('\\\\'+brackets[0])\n                   .split('}').join('\\\\'+brackets[1]),\n                  r.global ? 'g' : '')\n  }\n\n})()\n// { key, i in items} -> { key, i, items }\nfunction loopKeys(expr) {\n  var ret = { val: expr },\n      els = expr.split(/\\s+in\\s+/)\n\n  if (els[1]) {\n    ret.val = '{ ' + els[1]\n    els = els[0].slice(1).trim().split(/,\\s*/)\n    ret.key = els[0]\n    ret.pos = els[1]\n  }\n  return ret\n}\n\nfunction _each(dom, parent, expr) {\n\n  remAttr(dom, 'each')\n\n  var template = dom.outerHTML,\n      prev = dom.previousSibling,\n      root = dom.parentNode,\n      rendered = [],\n      tags = [],\n      checksum\n\n  expr = loopKeys(expr)\n\n  // clean template code after update (and let walk finish it's parse)\n  parent.one('update', function() {\n    root.removeChild(dom)\n\n  }).one('mount', function() {\n    if (!hasParent(root)) root = parent.root\n\n  }).on('update', function() {\n\n    var items = tmpl(expr.val, parent)\n    if (!items) return\n\n    // object loop. any changes cause full redraw\n    if (!Array.isArray(items)) {\n      var testsum = JSON.stringify(items)\n      if (testsum == checksum) return\n      checksum = testsum\n\n      // clear old items\n      tags.map(function(tag) {\n        tag.unmount()\n      })\n\n      tags = rendered = []\n\n      items = Object.keys(items).map(function(key, i) {\n        var obj = {}\n        obj[expr.key] = key\n        obj[expr.pos] = items[key]\n        return obj\n      })\n\n    }\n\n    // unmount redundant\n    arrDiff(rendered, items).map(function(item) {\n      var pos = rendered.indexOf(item),\n          tag = tags[pos]\n\n      if (tag) {\n        tag.unmount()\n        rendered.splice(pos, 1)\n        tags.splice(pos, 1)\n      }\n    })\n\n    // mount new\n    var nodes = root.childNodes,\n        prev_index = Array.prototype.indexOf.call(nodes, prev)\n\n    arrDiff(items, rendered).map(function(item, i) {\n\n      var pos = items.indexOf(item)\n\n      if (!checksum && expr.key) {\n        var obj = {}\n        obj[expr.key] = item\n        obj[expr.pos] = pos\n        item = obj\n      }\n\n      var tag = new Tag({ tmpl: template }, {\n        before: nodes[prev_index + 1 + pos],\n        parent: parent,\n        root: root,\n        loop: true,\n        item: item\n      })\n\n      tags.splice(pos, 0, tag)\n\n    })\n\n    rendered = items.slice()\n\n  })\n\n}\nfunction parseNamedElements(root, tag, expressions) {\n  walk(root, function(dom) {\n    if (dom.nodeType != 1) return\n\n    each(dom.attributes, function(attr) {\n      if (/^(name|id)$/.test(attr.name)) tag[attr.value] = dom\n    })\n  })\n}\n\nfunction parseLayout(root, tag, expressions) {\n\n  function addExpr(dom, value, data) {\n    if (tmpl(value) || data) {\n      var expr = { dom: dom, expr: value }\n      expressions.push(extend(expr, data || {}))\n    }\n  }\n\n  walk(root, function(dom) {\n\n    var type = dom.nodeType\n\n    // text node\n    if (type == 3 && dom.parentNode.tagName != 'STYLE') addExpr(dom, dom.nodeValue)\n    if (type != 1) return\n\n    /* element */\n\n    // loop\n    var attr = dom.getAttribute('each')\n    if (attr) { _each(dom, tag, attr); return false }\n\n    // child tag\n    var impl = tag_impl[dom.tagName.toLowerCase()]\n    if (impl) {\n      impl = new Tag(impl, { root: dom, parent: tag })\n      return false\n    }\n\n    // attributes\n    each(dom.attributes, function(attr) {\n      var name = attr.name,\n          value = attr.value\n\n      // expressions\n      var bool = name.split('__')[1]\n      addExpr(dom, value, { attr: bool || name, bool: bool })\n\n      if (bool) {\n        remAttr(dom, name)\n        return false\n      }\n\n    })\n\n  })\n\n}\nfunction Tag(impl, conf) {\n\n  var self = riot.observable(this),\n      expressions = [],\n      attributes = {},\n      parent = conf.parent,\n      is_loop = conf.loop,\n      root = conf.root,\n      opts = conf.opts,\n      item = conf.item\n\n  // cannot initialize twice on the same root element\n  if (!is_loop && root.riot) return\n  root.riot = 1\n\n  opts = opts || {}\n\n  extend(this, { parent: parent, root: root, opts: opts, children: [] })\n  extend(this, item)\n\n\n  // attributes\n  each(root.attributes, function(attr) {\n    var name = attr.name,\n        val = attr.value\n\n    attributes[name] = val\n\n    // remove dynamic attributes from node\n    if (val.indexOf('{') >= 0) {\n      remAttr(root, name)\n      return false\n    }\n  })\n\n  // options\n  function updateOpts() {\n    Object.keys(attributes).map(function(name) {\n      opts[name] = tmpl(attributes[name], parent || self)\n    })\n  }\n\n  updateOpts()\n\n  // child\n  parent && parent.children.push(this)\n\n  var dom = mkdom(impl.tmpl),\n      loop_dom\n\n  // named elements\n  parseNamedElements(dom, this)\n\n  this.update = function(data, init) {\n    extend(self, data)\n    extend(self, item)\n    self.trigger('update')\n    updateOpts()\n    update(expressions, self, item)\n    self.trigger('updated')\n  }\n\n  this.unmount = function() {\n\n    if (is_loop) {\n      root.removeChild(loop_dom)\n\n    } else {\n      var p = root.parentNode\n      p && p.removeChild(root)\n    }\n\n    // splice from parent.children[]\n    if (parent) {\n      var els = parent.children\n      els.splice(els.indexOf(self), 1)\n    }\n\n    self.trigger('unmount')\n\n    // cleanup\n    parent && parent.off('update', self.update)\n    mounted = false\n  }\n\n  function mount() {\n    while (dom.firstChild) {\n      if (is_loop) {\n        loop_dom = dom.firstChild\n        root.insertBefore(dom.firstChild, conf.before || null) // null needed for IE8\n\n      } else {\n        root.appendChild(dom.firstChild)\n      }\n    }\n\n    if (!hasParent(root)) self.root = root = parent.root\n\n    self.trigger('mount')\n\n    // one way data flow: propagate updates and unmounts downwards from parent to children\n    parent && parent.on('update', self.update).one('unmount', self.unmount)\n\n  }\n\n  // initialize\n  if (impl.fn) impl.fn.call(this, opts)\n\n  // layout\n  parseLayout(dom, this, expressions)\n\n  this.update()\n  mount()\n\n}\n\n\nfunction setEventHandler(name, handler, dom, tag, item) {\n\n  dom[name] = function(e) {\n\n    // cross browser event fix\n    e = e || window.event\n    e.which = e.which || e.charCode || e.keyCode\n    e.target = e.target || e.srcElement\n    e.currentTarget = dom\n    e.item = item\n\n    // prevent default behaviour (by default)\n    if (handler.call(tag, e) !== true) {\n      e.preventDefault && e.preventDefault()\n      e.returnValue = false\n    }\n\n    tag.update()\n  }\n\n}\n\nfunction insertTo(root, node, before) {\n  if (root) {\n    root.insertBefore(before, node)\n    root.removeChild(node)\n  }\n}\n\n// item = currently looped item\nfunction update(expressions, tag, item) {\n\n  each(expressions, function(expr) {\n    var dom = expr.dom,\n        attr_name = expr.attr,\n        value = tmpl(expr.expr, tag)\n\n    if (value == null) value = ''\n\n    // no change\n    if (expr.value === value) return\n    expr.value = value\n\n    // text node\n    if (!attr_name) return dom.nodeValue = value\n\n    // remove attribute\n    if (!value && expr.bool || /obj|func/.test(typeof value)) remAttr(dom, attr_name)\n\n    // event handler\n    if (typeof value == 'function') {\n      setEventHandler(attr_name, value, dom, tag, item)\n\n    // if- conditional\n    } else if (attr_name == 'if') {\n\n      remAttr(dom, attr_name)\n\n      var stub = expr.stub\n\n      // add to DOM\n      if (value) {\n        stub && insertTo(stub.parentNode, stub, dom)\n\n      // remove from DOM\n      } else {\n        stub = expr.stub = stub || document.createTextNode('')\n        insertTo(dom.parentNode, dom, stub)\n      }\n\n    // show / hide\n    } else if (/^(show|hide)$/.test(attr_name)) {\n      remAttr(dom, attr_name)\n      if (attr_name == 'hide') value = !value\n      dom.style.display = value ? '' : 'none'\n\n    // normal attribute\n    } else {\n      if (expr.bool) {\n        dom[attr_name] = value\n        if (!value) return\n        value = attr_name\n      }\n\n      dom.setAttribute(attr_name, value)\n    }\n\n  })\n\n}\nfunction each(nodes, fn) {\n  for (var i = 0; i < (nodes || []).length; i++) {\n    if (fn(nodes[i], i) === false) i--\n  }\n}\n\nfunction remAttr(dom, name) {\n  dom.removeAttribute(name)\n}\n\nfunction extend(obj, from) {\n  from && Object.keys(from).map(function(key) {\n    obj[key] = from[key]\n  })\n  return obj\n}\n\nfunction mkdom(template) {\n  var tag_name = template.trim().slice(1, 3).toLowerCase(),\n      root_tag = /td|th/.test(tag_name) ? 'tr' : tag_name == 'tr' ? 'tbody' : 'div'\n      el = document.createElement(root_tag)\n\n  el.stub = true\n  el.innerHTML = template\n  return el\n}\n\nfunction walk(dom, fn) {\n  dom = fn(dom) === false ? dom.nextSibling : dom.firstChild\n\n  while (dom) {\n    walk(dom, fn)\n    dom = dom.nextSibling\n  }\n}\n\nfunction arrDiff(arr1, arr2) {\n  return arr1.filter(function(el) {\n    return arr2.indexOf(el) < 0\n  })\n}\n\n// HTMLDocument == IE8 thing\nfunction hasParent(el) {\n  var p = el.parentNode,\n      doc = window.HTMLDocument\n\n  return p && !(doc && p instanceof doc)\n}\n\n/*\n Virtual dom is an array of custom tags on the document.\n Each tag stores an array of child tags.\n Updates and unmounts propagate downwards from parent to children.\n*/\n\nvar virtual_dom = [],\n    tag_impl = {}\n\nriot.tag = function(name, html, fn) {\n  tag_impl[name] = { name: name, tmpl: html, fn: fn }\n}\n\nvar mountTo = riot.mountTo = function(root, tagName, opts) {\n  var impl = tag_impl[tagName], tag\n\n  if (impl) tag = new Tag(impl, { root: root, opts: opts })\n\n  if (tag) {\n    virtual_dom.push(tag)\n    return tag.on('unmount', function() {\n      virtual_dom.splice(virtual_dom.indexOf(tag), 1)\n    })\n  }\n}\n\nriot.mount = function(selector, opts) {\n  if (selector == '*') selector = Object.keys(tag_impl).join(', ')\n\n  var tags = []\n\n  each(document.querySelectorAll(selector), function(root) {\n\n    var tagName = root.tagName.toLowerCase(),\n        tag = mountTo(root, tagName, opts)\n\n    if (tag) tags.push(tag)\n  })\n\n  return tags\n}\n\n// update everything\nriot.update = function() {\n  virtual_dom.map(function(tag) {\n    tag.update()\n  })\n  return virtual_dom\n}\n\n\n// support CommonJS\nif (typeof exports === 'object')\n  module.exports = riot\n\n// support AMD\nelse if (typeof define === 'function' && define.amd)\n  define(function() { return riot })\n\n// support browser\nelse\n  this.riot = riot\n\n})();\n"]}